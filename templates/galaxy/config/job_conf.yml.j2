---
##
## This file is maintained by Ansible - CHANGES WILL BE OVERWRITTEN
## Do not edit this file manually.
## Any changes will be automatically reverted.
##

#
# Job runner plugin configuration
#
runners:
{% for plugin in galaxy_jobconf['plugins']|sort(attribute='id') %}
  {{ plugin['id'] }}:
{% if 'local' in plugin['id'] %}
    workers: {{ galaxy_jobconf.plugin_workers }}
{% endif %}
{% if 'load' in plugin %}
    load: {{ plugin['load'] }}
{% endif %}
{% if 'pulsar_config' in plugin %}
    pulsar_config: {{ plugin['pulsar_config'] }}
{% endif %}

{% if 'params' in plugin %}
{% for k in plugin['params']|dict2items|sort(attribute='key')|list|items2dict %}
    {{ k }}: {{ plugin['params'][k] }}
{% endfor %}
{% endif %}
{% endfor %}

#
# Job handler configuration
#
handling:
{% if galaxy_jobconf.handlers.assign_with is defined %}
  assign_with:
    - {{ galaxy_jobconf.handlers.assign_with }}
{% endif %}
{% if galaxy_jobconf.handlers.default is defined %}
  default: {{ galaxy_jobconf.handlers.default }}
{% endif %}
{% if galaxy_jobconf.handlers.max_grab is defined %}
  max_grab: {{ galaxy_jobconf.handlers.max_grab }}
{% endif %}
{% if galaxy_jobconf.handlers.ready_window_size is defined %}
  ready_window_size: {{ galaxy_jobconf.handlers.ready_window_size }}
{% endif %}
{% if galaxy_handler_count is defined %}
  processes:
{% for n in range(galaxy_handler_count) %}
    handler_{{ galaxy_instance_codename }}_{{ n }}:
{% endfor %}
{% endif %}

#
# Job execution configuration
#
execution:
  default: {{ galaxy_jobconf['default_destination'] }}
  environments:
{% for destination in galaxy_jobconf['destinations']|sort(attribute='id') %}
    {{ destination['id'] }}:
      runner: {{ destination['runner'] }}
{% if 'type' in destination %}
      type: {{ destination['type'] }}
{% endif %}
{% if 'function' in destination %}
      function: {{ destination['function'] }}
{% endif %}
{% if 'rules_module' in destination %}
      rules_module: {{ destination['rules_module'] }}
{% endif %}
{% if 'tpv_config_files' in destination %}
      tpv_config_files:
{% for k in destination['tpv_config_files'] %}
        - {{ k }}
{% endfor %}
{% endif %}
{% if 'env' in destination %}
      env:
{% for k in destination['env']|dict2items|sort(attribute='key')|list|items2dict %}
        - name: {{ k }}
          value: {{ destination['env'][k] }}
{% endfor %}
{% endif %}
{% if 'params' in destination %}
{% for k in destination['params']|dict2items|sort(attribute='key')|list|items2dict %}
      {{ k }}: {{ destination['params'][k] }}
{% endfor %}
{% endif %}
{% endfor %}

#
# Job resource selector configuration
#
resources:
  groups:
{% for resource in galaxy_jobconf['resources'] %}
    {{ resource['id'] }}: {{ resource['names'] }}
{% endfor %}

#
# Job mapping configuration
#
tools:
{% for tool in galaxy_jobconf['tools'] %}
{% if 'resources' in tool %}
  - id: {{ tool['id'] }}
    environment: {{ tool['destination'] }}
    resources: {{ tool['resources'] }}
{% else %}
  - id: {{ tool['id'] }}
    environment: {{ tool['destination'] }}
{% endif %}
{% endfor %}

#
# Job limits configuration
#
limits:
{% for limit in galaxy_jobconf['limits'] | sort(attribute='type') %}
  - type: {{ limit['type'] }}
    value: {{ limit['value'] }}
{% if 'id' in limit %}
    id: {{ limit['id'] }}
{% elif 'tag' in limit %}
    tag: {{ limit['tag'] }}
{% elif 'window' in limit %}
    window: {{ limit['window'] }}
{% endif %}
{% endfor %}
